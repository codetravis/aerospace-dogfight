(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{3878:(e,t,i)=>{"use strict";i.d(t,{default:()=>_});var a=i(5155),n=i(2115);function s(e){switch(e){case"fighter":return{maxSpeed:5,health:80,shield:30,weaponRange:120,canAccelerate2:!0,canDecelerate2:!1,agility:4,maxWeaponCharge:15,damage:25,burst:2};case"bomber":return{maxSpeed:3,health:150,shield:80,weaponRange:180,canAccelerate2:!1,canDecelerate2:!1,agility:2,maxWeaponCharge:40,damage:50,burst:1};case"interceptor":return{maxSpeed:6,health:60,shield:20,weaponRange:100,canAccelerate2:!0,canDecelerate2:!0,agility:5,maxWeaponCharge:8,damage:7,burst:3};case"scout":return{maxSpeed:5,health:40,shield:30,weaponRange:100,canAccelrate2:!0,canDecelerate2:!1,agility:5,maxWeaponCharge:30,damage:10,burst:1};case"heavy_fighter":return{maxSpeed:4,health:100,shield:40,weaponRange:120,canAccelerate2:!1,canDecelerate2:!1,agility:3,maxWeaponCharge:15,damage:25,burst:3}}}function l(e,t){switch(e){case"straight":return{agility:0,difficulty:0};case"bank-left":case"bank-right":return{agility:1,difficulty:1};case"turn-left":case"turn-right":let i=2;return(1===t||t>3)&&(i+=1),{agility:i,difficulty:2};case"one-eight-oh":return{agility:5,difficulty:7};case"skid-left":case"skid-right":return{agility:3,difficulty:4};default:return{agility:999,difficulty:999}}}function r(e,t,i,a,n,l,r,o,c){let d=s(l),m=r||{composure:1,control:1,gunnery:1,guts:1},p=40+5*m.composure,u=Math.floor(m.guts/2)+1;return{id:e,x:t,y:i,angle:a,health:d.health,maxHealth:d.health,shield:d.shield,maxShield:d.shield,agility:d.agility,acceleration:2,maxSpeed:d.maxSpeed,speed:1,team:n,unitType:l,weaponRange:d.weaponRange,burst:d.burst,pilot:{id:c||"".concat(e,"-pilot"),name:o||"".concat(l.charAt(0).toUpperCase()+l.slice(1)," Pilot ").concat(e.split("-").pop()),skills:m,morale:p,maxMorale:120,strain:0,experience:0,level:1},maxStrain:u,plannedManeuver:"straight",plannedSpeedChange:"maintain",targetMode:"fire-at-will",specificTarget:void 0,maneuverProgress:0,initialAngle:a,finalOrientationChange:0,maneuverPathAngleChange:0,weaponCharge:0,maxWeaponCharge:d.maxWeaponCharge,firingLine:null,isDestroyed:!1,isEscaped:!1}}function o(e,t,i){let a=e;switch(t){case"accelerate":a=Math.min(e+1,i);break;case"accelerate-2":a=Math.min(e+2,i);break;case"decelerate":a=Math.max(e-1,1);break;case"decelerate-2":a=Math.max(e-2,1)}return a}function c(e,t){let i={...e};i.maneuverProgress=0,i.initialAngle=e.angle,i.speed=o(e.speed,e.plannedSpeedChange,e.maxSpeed);let a=l(e.plannedManeuver,i.speed),n=e.pilot.skills.control,s=e.plannedManeuver,r=e.pilot.strain,c=0,d=0;switch("one-eight-oh"===e.plannedManeuver&&i.speed<3?(s="straight",console.log("".concat(e.id," cannot perform ").concat(e.plannedManeuver," (Requires Speed 3+, Has ").concat(i.speed,"). Reverting to Straight."))):a.agility>i.agility?(s="straight",console.log("".concat(e.id," cannot perform ").concat(e.plannedManeuver," (Requires Agility ").concat(a.agility,", Has ").concat(i.agility,"). Reverting to Straight."))):a.difficulty>n+1?(s="straight",console.log("".concat(e.id," (Pilot ").concat(e.pilot.morale," morale, ").concat(e.pilot.strain,"/").concat(e.maxStrain," strain) cannot perform ").concat(e.plannedManeuver," (Difficulty ").concat(a.difficulty,", Pilot Control ").concat(n,"). Reverting to Straight."))):a.difficulty>n?e.pilot.strain>=e.maxStrain?(s="straight",console.log("".concat(e.id," (Pilot ").concat(e.pilot.morale," morale, ").concat(e.pilot.strain,"/").concat(e.maxStrain," strain) cannot perform ").concat(e.plannedManeuver," (Requires Control ").concat(a.difficulty,", Has ").concat(n,") due to max strain. Reverting to Straight."))):(r=Math.min(e.pilot.strain+1,e.maxStrain),console.log("".concat(e.id," (Pilot ").concat(e.pilot.morale," morale, ").concat(e.pilot.strain,"/").concat(e.maxStrain," strain) performs ").concat(e.plannedManeuver," (Requires Control ").concat(a.difficulty,", Has ").concat(n,"), gains 1 strain. New strain: ").concat(r))):(r=Math.max(e.pilot.strain-1,0),e.pilot.strain>0&&console.log("".concat(e.id," (Pilot ").concat(e.pilot.morale," morale, ").concat(e.pilot.strain,"/").concat(e.maxStrain," strain) performs ").concat(e.plannedManeuver," (Requires Control ").concat(a.difficulty,", Has ").concat(n,"), removes 1 strain. New strain: ").concat(r))),i.pilot={...i.pilot,strain:r},i.plannedManeuver=s,i.plannedManeuver){case"bank-left":c=-Math.PI/4,d=-Math.PI/4;break;case"bank-right":c=Math.PI/4,d=Math.PI/4;break;case"turn-left":c=-Math.PI/2,d=-Math.PI/2;break;case"turn-right":c=Math.PI/2,d=Math.PI/2;break;case"one-eight-oh":c=Math.PI,d=0;break;case"skid-left":c=-Math.PI/4-Math.PI/2,d=-Math.PI/4;break;case"skid-right":c=Math.PI/4+Math.PI/2,d=Math.PI/4;break;default:c=0,d=0}return i.finalOrientationChange=c,i.maneuverPathAngleChange=d,i}function d(e,t,i){let a={...e};a.maneuverProgress=Math.min(e.maneuverProgress+1/i,1);let n=30*e.speed/i,s=e.initialAngle;return 0!==a.maneuverPathAngleChange&&(s=e.initialAngle+a.maneuverPathAngleChange*a.maneuverProgress),a.x+=Math.cos(s)*n,a.y+=Math.sin(s)*n,a.angle=s,a.weaponCharge<a.maxWeaponCharge&&a.weaponCharge++,a.firingLine&&a.firingLine.ticksRemaining>0&&(a.firingLine.ticksRemaining--,a.firingLine.ticksRemaining<=0&&(a.firingLine=null)),a}function m(e,t){let i=t.x-e.x,a=t.y-e.y,n=Math.sqrt(i*i+a*a);if(n>e.weaponRange)return!1;let s=Math.cos(e.angle),l=Math.sin(e.angle);return!(i/n*s+a/n*l<Math.cos(Math.PI/6))&&!(Math.abs(s*a-l*i)>20)}function p(e,t){let i={...e};if(i.shield>0){let e=Math.min(t,i.shield);i.shield-=e,t-=e}return t>0&&(i.health-=t,i.health<=0&&(i.health=0,i.isDestroyed=!0)),i}function u(e){if("string"==typeof e)switch(e){case"fighter":return"Fighter";case"bomber":return"Bomber";case"interceptor":return"Interceptor";case"scout":return"Scout";case"heavy_fighter":return"Heavy Fighter"}switch(e){case 0:return"0 - Stationary";case 1:return"1 - Slow";case 2:return"2 - Cruise";case 3:return"3 - Fast";case 4:return"4 - Very Fast";case 5:return"5 - Maximum";case 6:return"6 - Afterburner";default:return"".concat(e)}}function h(e,t){let i=[],a={...e};a=c(a,t),i.push({x:a.x,y:a.y});for(let e=0;e<t;e++){let n=(e+1)/t,s=a.initialAngle;0!==a.maneuverPathAngleChange&&(s=a.initialAngle+a.maneuverPathAngleChange*n);let l=30*a.speed/t;a.x+=Math.cos(s)*l,a.y+=Math.sin(s)*l,i.push({x:a.x,y:a.y})}return a.angle=a.initialAngle+a.finalOrientationChange,i}function g(e,t){let i=e.x-t.x,a=e.y-t.y;return Math.sqrt(i*i+a*a)}function f(e,t,i,a,n){let s={...e,plannedManeuver:t,plannedSpeedChange:i,maneuverProgress:0,weaponCharge:0,firingLine:null};s=c(s,a);let l=!1;for(let e=0;e<a;e++){for(let e of(s=d(s,1,a),n))if(g(s,e)<e.radius+20){l=!0;break}if(l)break}return s.angle=s.initialAngle+s.finalOrientationChange,{simulatedUnit:s,collidedWithAsteroid:l}}function y(){let e=[{...r("Barracks-Fighter-1",0,0,0,"player","fighter"),pilot:void 0},{...r("Barracks-Interceptor-1",0,0,0,"player","interceptor"),pilot:void 0},{...r("Barracks-Heavy-Fighter-1",0,0,0,"player","heavy_fighter"),pilot:void 0},{...r("Barracks-Fighter-2",0,0,0,"player","fighter"),pilot:void 0}],t=[];return["Ace","Viper","Hammer","Maverick","Phoenix"].forEach((e,i)=>{let a=[3,2,2,1],n=["composure","control","gunnery","guts"];for(let e=n.length-1;e>0;e--){let t=Math.floor(Math.random()*(e+1));[n[e],n[t]]=[n[t],n[e]]}let s={composure:0,control:0,gunnery:0,guts:0};n.forEach((e,t)=>{s[e]=a[t]}),t.push({...r("Pilot-".concat(e),0,0,0,"player","fighter",s,e).pilot,id:"pilot-".concat(e.toLowerCase())})}),{units:e,pilots:t}}function x(e,t){let i=["dogfight","escort","intercept","lone-wolf","recon"],a=Math.floor(3*Math.random())+2,n=[];for(let s=0;s<a;s++){let a;let l=i[Math.floor(Math.random()*i.length)],o="mission-".concat(Date.now(),"-").concat(s),c="",d="",m=[],p=[],u=4,h=4,f={player:1,enemy:1};switch(l){case"dogfight":c="Dogfight over Sector ".concat(s+1),d="Engage enemy fighters in a classic dogfight.",m=[r("Enemy-Fighter-".concat(o,"-1"),700,250,Math.PI,"enemy","fighter"),r("Enemy-Fighter-".concat(o,"-2"),700,350,Math.PI,"enemy","fighter")],p=[{type:"destroy-units",targetUnitTypes:["fighter"],count:2,isCompleted:!1,description:"Destroy 2 enemy fighters."}];break;case"escort":c="Escort Convoy ".concat(s+1),d="Protect friendly bombers from enemy interceptors and guide them to safety.",u=2,h=2,f={perEscapedBomber:1,perDestroyedBomber:1};let y=r("Escort-Bomber-A-".concat(o),100,200,0,"player","bomber",{composure:3,control:3,gunnery:3,guts:3},"Escort Pilot A","escort-pilot-A-".concat(o)),x=r("Escort-Bomber-B-".concat(o),100,400,0,"player","bomber",{composure:3,control:3,gunnery:3,guts:3},"Escort Pilot B","escort-pilot-B-".concat(o));m=[r("Enemy-Interceptor-".concat(o,"-1"),700,150,Math.PI,"enemy","interceptor"),r("Enemy-Interceptor-".concat(o,"-2"),700,300,Math.PI,"enemy","interceptor"),r("Enemy-Interceptor-".concat(o,"-3"),700,450,Math.PI,"enemy","interceptor"),y,x],a=[y.id,x.id];let v=.5>Math.random()?60+Math.random()*(t/2-120):t-(60+Math.random()*(t/2-120));p=[{type:"destroy-units",targetUnitTypes:["interceptor"],count:3,isCompleted:!1,description:"Destroy 3 enemy interceptors."},{type:"reach-zone-and-return",targetUnitIds:[y.id,x.id],targetZone:{x:e-100,y:v,radius:50},escapeZone:{x:30,y:t/2,width:60,height:t},hasReachedZone:{[y.id]:!1,[x.id]:!1},hasEscapedZone:{[y.id]:!1,[x.id]:!1},isCompleted:!1,description:"Guide both bombers to the target zone and back to player's edge."}];break;case"recon":c="Recon Sector ".concat(s+1),d="Escort a Scout craft as it Recons the sector.",u=3,h=3,f={player:1,enemy:1};let b=r("Recon-Scout-A-".concat(o),100,200,0,"player","scout",{composure:3,control:5,gunnery:1,guts:2},"Recon Pilot A","Recon-pilot-A-".concat(o));m=[r("Enemy-Interceptor-".concat(o,"-1"),700,150,Math.PI,"enemy","interceptor"),r("Enemy-Interceptor-".concat(o,"-2"),700,300,Math.PI,"enemy","interceptor"),b],a=[b.id];let P=[];for(let i=0;i<3;i++){let a=function e(t,i,a,n,s,l,r,o,c){let d=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,m=arguments.length>10&&void 0!==arguments[10]?arguments[10]:100;if(d>=m)return null;let p=l+Math.random()*(r-l),u=o+Math.random()*(i-2*o),h=o+Math.random()*(a-2*o),f=!0;for(let e of n)if(g({x:u,y:h},e)<p+20+c){f=!1;break}if(f){for(let e of s)if(g({x:u,y:h},e)<p+e.radius+c){f=!1;break}}return f?{id:t,x:u,y:h,radius:p}:e(t,i,a,n,s,l,r,o,c,d+1,m)}("Target-Zone-".concat(o,"-").concat(i+1),e,t,[...m,b],[],30,30,60,90);if(a)P.push(a);else{console.warn("Could not generate target zone ".concat(i+1," for scout mission."));break}}let M={};P.forEach(e=>M[e.id]=!1),p=[{type:"visit-multiple-zones-and-return",targetUnitIds:[b.id],targetZones:P,escapeZone:{x:30,y:t/2,width:60,height:t},hasVisitedZone:M,hasEscapedZone:{[b.id]:!1},isCompleted:!1,description:"Visit all target zones and return to player's edge."}];break;case"intercept":c="Intercept Raid ".concat(s+1),d="Stop enemy bombers and their escorts before they reach their target.";let k="Enemy-Bomber-Target-".concat(o,"-1"),j="Enemy-Bomber-Target-".concat(o,"-2");m=[r("Enemy-Fighter-".concat(o,"-1"),700,250,Math.PI,"enemy","fighter"),r("Enemy-Fighter-".concat(o,"-2"),700,350,Math.PI,"enemy","fighter"),r(k,650,300,Math.PI,"enemy","bomber"),r(j,650,400,Math.PI,"enemy","bomber")],p=[{type:"destroy-units",targetUnitIds:[k,j],count:2,isCompleted:!1,description:"Destroy both enemy target bombers (".concat(k,", ").concat(j,").")}];break;case"lone-wolf":c="Lone Wolf: Deep Strike ".concat(s+1),d="A single fighter against overwhelming odds. High risk, high reward.",m=[r("Enemy-Bomber-".concat(o,"-1"),700,100,Math.PI,"enemy","bomber"),r("Enemy-Bomber-".concat(o,"-2"),700,250,Math.PI,"enemy","bomber"),r("Enemy-Bomber-".concat(o,"-3"),700,400,Math.PI,"enemy","bomber"),r("Enemy-Bomber-".concat(o,"-4"),700,550,Math.PI,"enemy","bomber")],p=[{type:"destroy-units",targetUnitTypes:["bomber"],count:4,isCompleted:!1,description:"Destroy all 4 enemy bombers."}]}n.push({id:o,type:l,name:c,description:d,enemyUnits:m,assignedUnitIds:[],assignedPilotIds:[],status:"pending",objectives:p,playerUnitLimit:u,playerPilotLimit:h,escortTargetUnitIds:a,isPlayed:!1,victoryPointsAward:f})}return n}function v(e,t,i){let a=e.assignedUnitIds.map(a=>{let n=t.find(e=>e.id===a);if(!n)return console.error("Unit ".concat(a," not found in barracks for mission ").concat(e.id)),r("Dummy-Unit",0,0,0,"player","fighter",void 0,"Dummy Pilot","dummy-pilot");let s=e.assignedPilotIds[e.assignedUnitIds.indexOf(a)],l=i.find(e=>e.id===s);return l?{...n,x:100+50*Math.random(),y:100+400*Math.random(),angle:0,isDestroyed:!1,isEscaped:!1,health:n.maxHealth,shield:n.maxShield,weaponCharge:0,firingLine:null,pilot:{...l,strain:0,morale:l.maxMorale}}:(console.error("Pilot ".concat(s," not found for unit ").concat(a," in mission ").concat(e.id)),{...n,pilot:r("Default-Pilot",0,0,0,"player","fighter").pilot})}),n=[],s=[];return e.enemyUnits.forEach(t=>{var i;(null===(i=e.escortTargetUnitIds)||void 0===i?void 0:i.includes(t.id))?s.push({...t,x:100+50*Math.random(),y:100+400*Math.random(),angle:0,isDestroyed:!1,isEscaped:!1,health:t.maxHealth,shield:t.maxShield,weaponCharge:0,firingLine:null,pilot:{...t.pilot,strain:0,morale:t.pilot.maxMorale}}):n.push({...t,x:700-50*Math.random(),y:100+400*Math.random(),isDestroyed:!1,isEscaped:!1,health:t.maxHealth,shield:t.maxShield,weaponCharge:0,firingLine:null,pilot:{...t.pilot,strain:0,morale:t.pilot.maxMorale}})}),[...a,...s,...n]}function b(e,t){let i={...e};for(i.experience+=t;i.experience>=10*i.level;)i.level++;return i}function P(e,t){let i={...e};return i.experience>=10&&i.skills[t]<10?(i.experience-=10,i.skills={...i.skills,[t]:i.skills[t]+1},console.log("".concat(i.name," leveled up ").concat(t,"! New value: ").concat(i.skills[t]))):console.warn("Cannot level up ".concat(t," for ").concat(i.name,". Not enough XP or skill is maxed.")),i}function M(e,t){let i=!0,a=t.map(e=>({...e})),n=[];return e.objectives.forEach(e=>{if(e.isCompleted){n.push(e);return}if("destroy-units"===e.type){let a=0;e.targetUnitIds?a=t.filter(t=>t.isDestroyed&&e.targetUnitIds.includes(t.id)).length:e.targetUnitTypes&&(a=t.filter(t=>t.isDestroyed&&"enemy"===t.team&&e.targetUnitTypes.includes(t.unitType)).length),a>=e.count?(console.log("Objective completed: ".concat(e.description)),n.push({...e,isCompleted:!0})):(i=!1,n.push(e))}else if("reach-zone-and-return"===e.type){let t={...e},s=!0;t.targetUnitIds.forEach(e=>{let i=a.find(t=>t.id===e);i&&(!i.isDestroyed||i.isEscaped)&&t.hasEscapedZone[e]||(s=!1)}),s?(console.log("Objective completed: ".concat(t.description)),n.push({...t,isCompleted:!0})):(i=!1,n.push(t))}else if("visit-multiple-zones-and-return"===e.type){let t={...e},s=a.find(e=>e.id===t.targetUnitIds[0]);if(!s||s.isDestroyed){i=!1,n.push(t);return}let l=t.targetZones.every(e=>t.hasVisitedZone[e.id]),r=t.hasEscapedZone[s.id];l&&r?(console.log("Objective completed: ".concat(t.description)),n.push({...t,isCompleted:!0})):(i=!1,n.push(t))}}),{updatedMission:{...e,objectives:n},updatedUnits:a,isMissionComplete:i}}function k(e,t,i,a){let n=[],s=0;for(;n.length<e&&s<100;){let e=20+20*Math.random(),l=60+Math.random()*(t-120),r=60+Math.random()*(i-120),o=function(e,t,i,a){let n=Math.floor(4*Math.random())+5,s=[],l=2*Math.PI/n;for(let r=0;r<n;r++){let n=r*l+l/2*(Math.random()-.5),o=i+Math.random()*(a-i);s.push({x:e+o*Math.cos(n),y:t+o*Math.sin(n)})}return s}(l,r,.7*e,1.3*e),c=!0;for(let t of n)if(g({x:l,y:r},t)<60+e+t.radius){c=!1;break}for(let t of a)if(g({x:l,y:r},t)<e+20+60){c=!1;break}let d=e-5;c&&n.push({id:"asteroid-".concat(n.length+1),x:l,y:r,points:o,radius:d,collidedUnitsThisPhase:[]}),s++}return n}function j(e){let{units:t,selectedUnit:i,onUnitSelect:s,width:l,height:r,maxResolutionTicks:o,isPlanningPhase:c,asteroids:d,currentMission:m}=e,p=(0,n.useRef)(null);return(0,n.useEffect)(()=>{let e=p.current;if(!e)return;let a=e.getContext("2d");if(!a)return;let n=window.devicePixelRatio||1;e.width=l*n,e.height=r*n,a.scale(n,n),a.fillStyle="#000011",a.fillRect(0,0,l,r),a.fillStyle="#ffffff";for(let e=0;e<100;e++){let t=37*e%l,i=73*e%r;a.fillRect(t,i,1,1)}d.forEach(e=>{if(a.save(),a.fillStyle="#888888",a.strokeStyle="#aaaaaa",a.lineWidth=1,a.beginPath(),e.points.length>0){a.moveTo(e.points[0].x,e.points[0].y);for(let t=1;t<e.points.length;t++)a.lineTo(e.points[t].x,e.points[t].y);a.closePath()}else a.arc(e.x,e.y,e.radius,0,2*Math.PI);a.fill(),a.stroke(),a.restore()}),null==m||m.objectives.forEach(e=>{if("reach-zone-and-return"===e.type){let{x:t,y:i,radius:n}=e.targetZone,{x:s,y:l,width:r,height:o}=e.escapeZone;a.save(),a.beginPath(),a.arc(t,i,n,0,2*Math.PI),a.strokeStyle="#00ffcc",a.lineWidth=2,a.setLineDash([5,5]),a.stroke(),e.isCompleted?a.fillStyle="#00ffcc40":a.fillStyle="#00ffcc20",a.fill(),a.font="12px Arial",a.fillStyle="#00ffcc",a.textAlign="center",a.fillText("Target Zone",t,i-n-10),a.restore(),a.save(),a.beginPath(),a.rect(s-r/2,l-o/2,r,o),a.strokeStyle="#ffcc00",a.lineWidth=2,a.setLineDash([5,5]),a.stroke(),a.fillStyle="#ffcc0020",a.fill(),a.font="12px Arial",a.fillStyle="#ffcc00",a.textAlign="center",a.fillText("Escape Zone",s,l-o/2-10),a.restore()}else if("visit-multiple-zones-and-return"===e.type){let{x:t,y:i,width:n,height:s}=e.escapeZone;e.targetZones.forEach(t=>{a.save(),a.beginPath(),a.arc(t.x,t.y,t.radius,0,2*Math.PI),a.strokeStyle=e.hasVisitedZone[t.id]?"#00ff00":"#ff0000",a.lineWidth=2,a.setLineDash([5,5]),a.stroke(),a.fillStyle=e.hasVisitedZone[t.id]?"#00ff0040":"#ff000020",a.fill(),a.font="12px Arial",a.fillStyle=e.hasVisitedZone[t.id]?"#00ff00":"#ff0000",a.textAlign="center",a.fillText("Target ".concat(t.id.split("-").pop()),t.x,t.y-t.radius-10),a.restore()}),a.save(),a.strokeStyle="rgba(255,255,0,0.8)",a.setLineDash([6,4]),a.lineWidth=2,a.strokeRect(t-n/2,i-s/2,n,s),a.restore()}});let s=t.find(e=>e.id===i);if(!s||s.isDestroyed||s.isEscaped||(a.save(),a.translate(s.x,s.y),a.rotate(s.angle),a.strokeStyle="#ffff0044",a.lineWidth=1,a.setLineDash([]),a.strokeRect(0,-20,s.weaponRange,40),a.restore()),t.forEach(e=>{e.firingLine&&e.firingLine.ticksRemaining>0&&(a.save(),e.firingLine.hasTarget?(a.strokeStyle="player"===e.team?"#00ff00":"#ff0000",a.lineWidth=2,a.setLineDash([])):(a.strokeStyle="player"===e.team?"#00ff0080":"#ff000080",a.lineWidth=1,a.setLineDash([5,5])),a.beginPath(),a.moveTo(e.firingLine.fromX,e.firingLine.fromY),a.lineTo(e.firingLine.toX,e.firingLine.toY),a.stroke(),a.restore())}),t.forEach(e=>{e.isDestroyed||e.isEscaped||(a.save(),e.id===i?(a.fillStyle="#00bfff20",a.strokeStyle="#00bfff",a.lineWidth=2):(a.fillStyle="#ffff0015",a.strokeStyle="#ffff0060",a.lineWidth=1),a.setLineDash([]),a.fillRect(e.x-25,e.y-20,50,40),a.strokeRect(e.x-25,e.y-20,50,40),a.restore())}),c&&s&&!s.isDestroyed&&!s.isEscaped){let e=h(s,o);if(e.length>1){a.save(),a.strokeStyle="#ffffff",a.lineWidth=1,a.setLineDash([5,5]),a.beginPath(),a.moveTo(e[0].x,e[0].y);for(let t=1;t<e.length;t++)a.lineTo(e[t].x,e[t].y);a.stroke(),a.restore()}}t.forEach(e=>{if(e.isDestroyed||e.isEscaped)return;switch(a.save(),a.translate(e.x,e.y),a.rotate(e.angle),a.fillStyle="player"===e.team?"#00ff00":"#ff0000",a.beginPath(),e.unitType){case"fighter":a.moveTo(15,0),a.lineTo(-8,-6),a.lineTo(-5,0),a.lineTo(-8,6),a.closePath();break;case"bomber":a.moveTo(10,4),a.lineTo(10,-4),a.lineTo(-6,-15),a.lineTo(-15,-15),a.lineTo(-15,-4),a.lineTo(-10,-2),a.lineTo(-10,2),a.lineTo(-15,4),a.lineTo(-15,15),a.lineTo(-6,15),a.closePath();break;case"interceptor":a.moveTo(10,1),a.lineTo(10,-1),a.lineTo(15,-4),a.lineTo(6,-4),a.lineTo(-2,-4),a.lineTo(-8,-6),a.lineTo(-10,-6),a.lineTo(-10,6),a.lineTo(-8,6),a.lineTo(-2,4),a.lineTo(6,4),a.lineTo(15,4),a.closePath();break;case"scout":a.moveTo(5,3),a.lineTo(5,-3),a.lineTo(-8,-6),a.lineTo(-5,0),a.lineTo(-8,6),a.closePath();break;case"heavy_fighter":a.moveTo(15,0),a.lineTo(-1,-6),a.lineTo(-8,-6),a.lineTo(-5,0),a.lineTo(-8,6),a.lineTo(-1,6),a.closePath()}a.fill(),a.restore();let t=e.health/e.maxHealth,i=e.shield/e.maxShield;a.fillStyle="#ff0000",a.fillRect(e.x-15,e.y-20,30,4),a.fillStyle="#00ff00",a.fillRect(e.x-15,e.y-20,30*t,4),e.shield>0&&(a.fillStyle="#0088ff",a.fillRect(e.x-15,e.y-25,30*i,3)),a.fillStyle="#ffffff",a.font="10px Arial",a.textAlign="center";let n=e.unitType.charAt(0).toUpperCase();if(a.fillText(n,e.x,e.y+35),("bomber"===e.unitType||"scout"===e.unitType)&&"player"===e.team&&m){let t=m.objectives.find(e=>"reach-zone-and-return"===e.type);t&&(t.hasReachedZone[e.id]&&(a.save(),a.beginPath(),a.arc(e.x+20,e.y-20,5,0,2*Math.PI),a.fillStyle="#00ff00",a.fill(),a.restore()),t.hasEscapedZone[e.id]&&(a.save(),a.beginPath(),a.arc(e.x+20,e.y-10,5,0,2*Math.PI),a.fillStyle="#00bfff",a.fill(),a.restore()))}if("scout"===e.unitType&&"player"===e.team&&m){let t=m.objectives.find(e=>"visit-multiple-zones-and-return"===e.type);t&&(t.targetZones.every(e=>t.hasVisitedZone[e.id])&&(a.save(),a.beginPath(),a.arc(e.x+20,e.y-20,5,0,2*Math.PI),a.fillStyle="#00ff00",a.fill(),a.restore()),t.hasEscapedZone[e.id]&&(a.save(),a.beginPath(),a.arc(e.x+20,e.y-10,5,0,2*Math.PI),a.fillStyle="#00bfff",a.fill(),a.restore()))}})},[t,i,l,r,o,c,d,m]),(0,a.jsx)("canvas",{ref:p,width:l,height:r,onClick:e=>{let a=p.current;if(!a)return;let n=a.getBoundingClientRect(),l=a.width/n.width,r=a.height/n.height,o=(e.clientX-n.left)*l,c=(e.clientY-n.top)*r,d=window.devicePixelRatio||1,m=o/d,u=c/d,h=!1;for(let e=0;e<t.length;e++){let i=t[e];if(i.isDestroyed||i.isEscaped)continue;let a=m>=i.x-25&&m<=i.x+25,n=u>=i.y-20&&u<=i.y+20;if(a&&n){s(i.id),h=!0;break}}!h&&i&&s(null)},className:"border border-gray-600 cursor-pointer",style:{width:"".concat(l,"px"),height:"".concat(r,"px")}})}var S=i(4624),I=i(2085),N=i(2596),w=i(9688);function T(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return(0,w.QP)((0,N.$)(t))}let C=(0,I.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),E=n.forwardRef((e,t)=>{let{className:i,variant:n,size:s,asChild:l=!1,...r}=e,o=l?S.DX:"button";return(0,a.jsx)(o,{className:T(C({variant:n,size:s,className:i})),ref:t,...r})});E.displayName="Button";let U=n.forwardRef((e,t)=>{let{className:i,...n}=e;return(0,a.jsx)("div",{ref:t,className:T("rounded-lg border bg-card text-card-foreground shadow-sm",i),...n})});U.displayName="Card";let D=n.forwardRef((e,t)=>{let{className:i,...n}=e;return(0,a.jsx)("div",{ref:t,className:T("flex flex-col space-y-1.5 p-6",i),...n})});D.displayName="CardHeader";let R=n.forwardRef((e,t)=>{let{className:i,...n}=e;return(0,a.jsx)("div",{ref:t,className:T("text-2xl font-semibold leading-none tracking-tight",i),...n})});R.displayName="CardTitle",n.forwardRef((e,t)=>{let{className:i,...n}=e;return(0,a.jsx)("div",{ref:t,className:T("text-sm text-muted-foreground",i),...n})}).displayName="CardDescription";let A=n.forwardRef((e,t)=>{let{className:i,...n}=e;return(0,a.jsx)("div",{ref:t,className:T("p-6 pt-0",i),...n})});A.displayName="CardContent",n.forwardRef((e,t)=>{let{className:i,...n}=e;return(0,a.jsx)("div",{ref:t,className:T("flex items-center p-6 pt-0",i),...n})}).displayName="CardFooter";var B=i(1838);let Z=n.forwardRef((e,t)=>{let{className:i,value:n,...s}=e;return(0,a.jsx)(B.bL,{ref:t,className:T("relative h-4 w-full overflow-hidden rounded-full bg-secondary",i),...s,children:(0,a.jsx)(B.C1,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:"translateX(-".concat(100-(n||0),"%)")}})})});function L(e){let{selectedUnit:t,units:i,onUpdateUnit:r,onStartResolution:c}=e;i.filter(e=>"player"===e.team&&!e.isDestroyed);let d=i.filter(e=>"enemy"===e.team&&!e.isDestroyed),[m,p]=(0,n.useState)(t?o(t.speed,t.plannedSpeedChange,t.maxSpeed):1);if((0,n.useEffect)(()=>{t&&p(o(t.speed,t.plannedSpeedChange,t.maxSpeed))},[t]),!t)return(0,a.jsxs)(U,{className:"w-80",children:[(0,a.jsx)(D,{children:(0,a.jsx)(R,{children:"Planning Phase"})}),(0,a.jsxs)(A,{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground mb-4",children:"Select a unit to plan its maneuvers"}),(0,a.jsx)(E,{onClick:c,className:"w-full",children:"Start Resolution Phase"})]})]});let h=t.weaponCharge/t.maxWeaponCharge*100,g=function(e,t,i){let a=[],n=s(i);if(a.push({value:e,label:u(e)+" (Maintain)",plannedChange:"maintain"}),e<t){let i=Math.min(e+1,t);a.push({value:i,label:u(i)+" (Accelerate +1)",plannedChange:"accelerate"})}if(n.canAccelerate2&&e<t-1){let i=Math.min(e+2,t);a.push({value:i,label:u(i)+" (Accelerate +2)",plannedChange:"accelerate-2"})}else n.canAccelerate2&&e===t-1&&a.push({value:t,label:u(t)+" (Accelerate +2)",plannedChange:"accelerate-2"});if(e>1){let t=Math.max(e-1,1);a.push({value:t,label:u(t)+" (Decelerate -1)",plannedChange:"decelerate"})}if(n.canDecelerate2&&e>2){let t=Math.max(e-2,1);a.push({value:t,label:u(t)+" (Decelerate -2)",plannedChange:"decelerate-2"})}else n.canDecelerate2&&e<=2&&e>1&&a.push({value:1,label:u(1)+" (Decelerate -2)",plannedChange:"decelerate-2"});a.sort((e,t)=>e.value-t.value);let l=new Map,r={maintain:0,accelerate:1,"accelerate-2":2,decelerate:3,"decelerate-2":4};return a.forEach(e=>{(!l.has(e.value)||r[e.plannedChange]<r[l.get(e.value).plannedChange])&&l.set(e.value,e)}),Array.from(l.values())}(t.speed,t.maxSpeed,t.unitType);return(0,a.jsxs)(U,{className:"w-80",children:[(0,a.jsx)(D,{children:(0,a.jsxs)(R,{children:[t.id," (",u(t.unitType),")"]})}),(0,a.jsxs)(A,{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"Planned Speed"}),(0,a.jsx)("select",{value:m,onChange:e=>{let i=Number.parseInt(e.target.value);p(i);let a=g.find(e=>e.value===i);a&&r(t.id,{plannedSpeedChange:a.plannedChange})},className:"w-full mt-1 p-2 border rounded",children:g.map(e=>(0,a.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"Maneuver"}),(0,a.jsx)("select",{value:t.plannedManeuver,onChange:e=>r(t.id,{plannedManeuver:e.target.value}),className:"w-full mt-1 p-2 border rounded",children:[{value:"straight",label:"Straight"},{value:"bank-left",label:"Bank Left (1/8 circle)"},{value:"bank-right",label:"Bank Right (1/8 circle)"},{value:"turn-left",label:"Turn Left (1/4 circle)"},{value:"turn-right",label:"Turn Right (1/4 circle)"},{value:"one-eight-oh",label:"One-Eight-Oh (180\xb0 Flip)"},{value:"skid-left",label:"Skid Left (90\xb0 Rotation)"},{value:"skid-right",label:"Skid Right (90\xb0 Rotation)"}].map(e=>{let i=l(e.value,m),n=i.agility>t.agility,s=i.difficulty>t.pilot.skills.control,r=i.difficulty>t.pilot.skills.control+1,o=t.pilot.strain>=t.maxStrain&&s,c="one-eight-oh"===e.value&&m<3,d=n||r||o||c,p="";return n?p="(Requires Agility ".concat(i.agility,", Has ").concat(t.agility,")"):r?p="(Requires Control ".concat(i.difficulty,", Max Allowed ").concat(t.pilot.skills.control+1,")"):o?p="(Max Strain Reached, Requires Control ".concat(i.difficulty,", Has ").concat(t.pilot.skills.control,")"):c?p="(Requires Speed 3+, Planned ".concat(m,")"):s&&(p="(Requires Control ".concat(i.difficulty,", Has ").concat(t.pilot.skills.control,")")),(0,a.jsxs)("option",{value:e.value,disabled:d,children:[e.label," (Agility: ",i.agility,", Difficulty: ",i.difficulty,")"," ",d&&p]},e.value)})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"Target Mode"}),(0,a.jsxs)("select",{value:t.targetMode,onChange:e=>r(t.id,{targetMode:e.target.value}),className:"w-full mt-1 p-2 border rounded",children:[(0,a.jsx)("option",{value:"fire-at-will",children:"Fire at Will"}),(0,a.jsx)("option",{value:"target-specific",children:"Specific Target"})]})]}),"target-specific"===t.targetMode&&(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"Target"}),(0,a.jsxs)("select",{value:t.specificTarget||"",onChange:e=>r(t.id,{specificTarget:e.target.value||void 0}),className:"w-full mt-1 p-2 border rounded",children:[(0,a.jsx)("option",{value:"",children:"Select Target"}),d.map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.id," (",u(e.unitType),")"]},e.id))]})]}),(0,a.jsxs)("div",{className:"pt-4 space-y-2",children:[(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsx)("span",{className:"font-medium",children:"Type:"})," ",u(t.unitType)]}),(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsx)("span",{className:"font-medium",children:"Health:"})," ",t.health,"/",t.maxHealth]}),(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsx)("span",{className:"font-medium",children:"Shield:"})," ",t.shield,"/",t.maxShield]}),(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsx)("span",{className:"font-medium",children:"Current Speed:"})," ",u(t.speed)]}),(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsx)("span",{className:"font-medium",children:"Max Speed:"})," ",t.maxSpeed]}),(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsx)("span",{className:"font-medium",children:"Agility:"})," ",t.agility]}),(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsx)("span",{className:"font-medium",children:"Weapon Range:"})," ",t.weaponRange]}),(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsx)("span",{className:"font-medium",children:"Weapon Charge:"})," ",t.weaponCharge,"/",t.maxWeaponCharge]}),(0,a.jsx)(Z,{value:h,className:"w-full"}),t.weaponCharge>=t.maxWeaponCharge&&(0,a.jsx)("div",{className:"text-xs text-green-600 font-medium",children:"WEAPON READY"}),(0,a.jsxs)("div",{className:"pt-2 border-t border-gray-700",children:[(0,a.jsx)("h3",{className:"text-md font-semibold mb-1",children:"Pilot Skills"}),(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsx)("span",{className:"font-medium",children:"Composure:"})," ",t.pilot.skills.composure]}),(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsx)("span",{className:"font-medium",children:"Control:"})," ",t.pilot.skills.control]}),(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsx)("span",{className:"font-medium",children:"Gunnery:"})," ",t.pilot.skills.gunnery]}),(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsx)("span",{className:"font-medium",children:"Guts:"})," ",t.pilot.skills.guts]}),(0,a.jsxs)("div",{className:"text-sm mt-2",children:[(0,a.jsx)("span",{className:"font-medium",children:"Morale:"})," ",t.pilot.morale,"/",t.pilot.maxMorale]}),(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsx)("span",{className:"font-medium",children:"Strain:"})," ",t.pilot.strain,"/",t.maxStrain]})]})]}),(0,a.jsx)(E,{onClick:c,className:"w-full",children:"Start Resolution Phase"})]})]})}function F(e){let{currentTick:t,maxTicks:i,onEndResolution:n}=e;return(0,a.jsxs)(U,{className:"w-80",children:[(0,a.jsx)(D,{children:(0,a.jsx)(R,{children:"Resolution Phase"})}),(0,a.jsxs)(A,{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex justify-between text-sm mb-2",children:[(0,a.jsxs)("span",{children:["Tick: ",t]}),(0,a.jsxs)("span",{children:["Max: ",i]})]}),(0,a.jsx)(Z,{value:t/i*100,className:"w-full"})]}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Units are executing their planned maneuvers and engaging targets."}),(0,a.jsx)(E,{onClick:n,variant:"outline",className:"w-full bg-transparent",children:"End Resolution Early"})]})]})}function V(e){let{onSelectOption:t}=e;return(0,a.jsxs)(U,{className:"w-96",children:[(0,a.jsx)(D,{children:(0,a.jsx)(R,{className:"text-center text-3xl",children:"Space Dogfight"})}),(0,a.jsxs)(A,{className:"space-y-4",children:[(0,a.jsx)(E,{onClick:()=>t("skirmish"),className:"w-full",children:"Skirmish"}),(0,a.jsx)(E,{onClick:()=>t("campaign"),className:"w-full",children:"Campaign"})]})]})}function z(e){let{onStartSkirmish:t,onBackToMenu:i}=e;return(0,a.jsxs)(U,{className:"w-96",children:[(0,a.jsx)(D,{children:(0,a.jsx)(R,{className:"text-center text-2xl",children:"Choose Battle Setup"})}),(0,a.jsxs)(A,{className:"space-y-4",children:[(0,a.jsx)(E,{onClick:()=>t("dogfight"),className:"w-full",children:"Dogfight (2 Fighters vs 2 Fighters)"}),(0,a.jsx)(E,{onClick:()=>t("escort"),className:"w-full",children:"Escort (2 Bombers, 2 Fighters vs 3 Interceptors)"}),(0,a.jsx)(E,{onClick:()=>t("intercept"),className:"w-full",children:"Intercept (3 Interceptors vs 2 Fighters, 2 Bombers)"}),(0,a.jsx)(E,{onClick:()=>t("lone-wolf"),className:"w-full",children:"Lone Wolf (1 Fighter vs 4 Bombers)"}),(0,a.jsx)(E,{onClick:()=>t("test-flight"),className:"w-full",children:"Test Flight (1 of Each Ship Type)"}),(0,a.jsx)(E,{onClick:i,variant:"outline",className:"w-full bg-transparent",children:"Back to Main Menu"})]})]})}function W(e){let{onOpenMissionPlanning:t,onOpenBarracks:i,onBackToMainMenu:n}=e;return(0,a.jsxs)(U,{className:"w-96",children:[(0,a.jsx)(D,{children:(0,a.jsx)(R,{className:"text-center text-2xl",children:"Campaign"})}),(0,a.jsxs)(A,{className:"space-y-4",children:[(0,a.jsx)(E,{onClick:t,className:"w-full",children:"Mission Planning"}),(0,a.jsx)(E,{onClick:i,className:"w-full",children:"Barracks"}),(0,a.jsx)(E,{onClick:n,variant:"outline",className:"w-full bg-transparent",children:"Back to Main Menu"})]})]})}function H(e){let{playerPilotsInBarracks:t,onLevelUpPilotSkill:i,onBackToCampaignMenu:n}=e;return(0,a.jsxs)(U,{className:"w-[600px]",children:[(0,a.jsx)(D,{children:(0,a.jsx)(R,{className:"text-center text-2xl",children:"Barracks"})}),(0,a.jsxs)(A,{className:"space-y-6",children:[0===t.length?(0,a.jsx)("p",{className:"text-center text-muted-foreground",children:"No pilots in barracks. Start a campaign to get pilots!"}):(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:t.map(e=>(0,a.jsxs)(U,{className:"p-4",children:[(0,a.jsxs)("h3",{className:"text-lg font-semibold mb-2",children:[e.name," (Level ",e.level,")"]}),(0,a.jsxs)("div",{className:"text-sm space-y-1",children:[(0,a.jsxs)("p",{children:[(0,a.jsx)("span",{className:"font-medium",children:"XP:"})," ",e.experience]}),(0,a.jsx)(Z,{value:e.experience%10*10,className:"w-full h-2"}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Next skill point at 10 XP"})]}),(0,a.jsx)("div",{className:"mt-3 space-y-2",children:Object.entries(e.skills).map(t=>{let[n,s]=t;return(0,a.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,a.jsxs)("span",{className:"font-medium capitalize",children:[n,": ",s]}),(0,a.jsx)(E,{variant:"secondary",size:"sm",onClick:()=>i(e.id,n),disabled:e.experience<10||s>=10,children:"Level Up (+1)"})]},n)})})]},e.id))}),(0,a.jsx)(E,{onClick:n,variant:"outline",className:"w-full bg-transparent mt-4",children:"Back to Campaign Menu"})]})]})}function O(e){let{availableMissions:t,playerUnitsInBarracks:i,playerPilotsInBarracks:s,onAssignUnitToMission:l,onAssignPilotToMission:r,onUnassignUnitFromMission:o,onUnassignPilotFromMission:c,onStartSelectedMission:d,onBackToCampaignMenu:m,playerVictoryPoints:p,enemyVictoryPoints:u}=e,[h,g]=(0,n.useState)(null),[f,y]=(0,n.useState)(null),[x,v]=(0,n.useState)(null),b=t.find(e=>e.id===h),P=e=>{switch(e){case"fighter":return"Fighter";case"bomber":return"Bomber";case"interceptor":return"Interceptor";case"scout":return"Scout";case"heavy_fighter":return"Heavy Fighter"}},M=e=>t.some(t=>t.assignedUnitIds.includes(e)),k=e=>t.some(t=>t.assignedPilotIds.includes(e)),j=b&&f&&!M(f)&&b.assignedUnitIds.length<b.playerUnitLimit,S=b&&x&&!k(x)&&b.assignedPilotIds.length<b.playerPilotLimit,I=e=>{h&&o(h,e)},N=e=>{h&&c(h,e)},w=e=>e.assignedUnitIds.length>0&&e.assignedUnitIds.length===e.assignedPilotIds.length,C=e=>"pending"===e.status&&!e.isPlayed&&0===e.assignedUnitIds.length&&0===e.assignedPilotIds.length,B=(null==b?void 0:b.escortTargetUnitIds)?b.enemyUnits.filter(e=>{var t;return null===(t=b.escortTargetUnitIds)||void 0===t?void 0:t.includes(e.id)}):[];return(0,a.jsxs)(U,{className:"w-[900px]",children:[(0,a.jsxs)(D,{children:[(0,a.jsx)(R,{className:"text-center text-2xl",children:"Mission Planning"}),(0,a.jsxs)("div",{className:"text-center text-sm text-muted-foreground",children:["Victory Points: Player ",p," - Enemy ",u]})]}),(0,a.jsxs)(A,{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{className:"col-span-1 space-y-2",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"Available Missions"}),0===t.length?(0,a.jsx)("p",{className:"text-muted-foreground text-sm",children:"No missions available."}):(0,a.jsx)("div",{className:"space-y-2 max-h-[400px] overflow-y-auto pr-2",children:t.map(e=>(0,a.jsxs)(U,{className:T("p-3 cursor-pointer transition-colors",h===e.id?"border-blue-500 ring-2 ring-blue-500":"hover:bg-gray-800",("pending"!==e.status||e.isPlayed)&&"opacity-50 cursor-not-allowed"),onClick:()=>"pending"===e.status&&!e.isPlayed&&g(e.id),children:[(0,a.jsx)("h4",{className:"font-semibold",children:e.name}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:e.description}),(0,a.jsxs)("div",{className:"text-xs mt-1",children:[(0,a.jsxs)("p",{children:["Status: ",e.status.charAt(0).toUpperCase()+e.status.slice(1)]}),(0,a.jsxs)("p",{children:["Played: ",e.isPlayed?"Yes":"No"]})," ",(0,a.jsxs)("p",{children:["Ships: ",e.assignedUnitIds.length," / ",e.playerUnitLimit]}),(0,a.jsxs)("p",{children:["Pilots: ",e.assignedPilotIds.length," / ",e.playerPilotLimit]})]}),h===e.id&&"pending"===e.status&&!e.isPlayed&&(0,a.jsxs)("div",{className:"mt-2 flex gap-2",children:[w(e)&&(0,a.jsx)(E,{size:"sm",className:"flex-1",onClick:t=>{t.stopPropagation(),d(e.id)},children:"Start Mission"}),C(e)&&(0,a.jsx)(E,{size:"sm",variant:"outline",className:"flex-1 bg-transparent",onClick:t=>{t.stopPropagation(),d(e.id,!0)},children:"Pass Mission"})]})]},e.id))})]}),(0,a.jsxs)("div",{className:"col-span-2 space-y-4",children:[b?(0,a.jsxs)(U,{className:"p-4",children:[(0,a.jsx)("h3",{className:"text-xl font-bold mb-2",children:b.name}),(0,a.jsx)("p",{className:"text-muted-foreground mb-4",children:b.description}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h4",{className:"font-semibold mb-2",children:["Assigned Ships (",b.assignedUnitIds.length,"/",b.playerUnitLimit,")"]}),(0,a.jsx)("div",{className:"space-y-2 max-h-[150px] overflow-y-auto pr-2",children:0===b.assignedUnitIds.length&&0===B.length?(0,a.jsx)("p",{className:"text-muted-foreground text-sm",children:"No ships assigned."}):(0,a.jsxs)(a.Fragment,{children:[B.map(e=>(0,a.jsx)("div",{className:"flex items-center justify-between bg-gray-700 p-2 rounded",children:(0,a.jsxs)("span",{className:"text-sm",children:[e.id," (",P(e.unitType),") - Auto-assigned"]})},e.id)),b.assignedUnitIds.map(e=>{let t=i.find(t=>t.id===e);return t?(0,a.jsxs)("div",{className:"flex items-center justify-between bg-gray-800 p-2 rounded",children:[(0,a.jsxs)("span",{className:"text-sm",children:[t.id," (",P(t.unitType),")"]}),(0,a.jsx)(E,{variant:"ghost",size:"sm",onClick:()=>I(t.id),children:"Unassign"})]},t.id):null})]})}),(0,a.jsx)("div",{className:"mt-4",children:(0,a.jsx)(E,{onClick:()=>{h&&f&&(l(h,f),y(null))},disabled:!j,className:"w-full",children:"Assign Selected Ship"})})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("h4",{className:"font-semibold mb-2",children:["Assigned Pilots (",b.assignedPilotIds.length,"/",b.playerPilotLimit,")"]}),(0,a.jsx)("div",{className:"space-y-2 max-h-[150px] overflow-y-auto pr-2",children:0===b.assignedPilotIds.length&&0===B.length?(0,a.jsx)("p",{className:"text-muted-foreground text-sm",children:"No pilots assigned."}):(0,a.jsxs)(a.Fragment,{children:[B.map(e=>(0,a.jsx)("div",{className:"flex items-center justify-between bg-gray-700 p-2 rounded",children:(0,a.jsxs)("span",{className:"text-sm",children:[e.pilot.name," (Lvl ",e.pilot.level,") - Auto-assigned"]})},e.pilot.id)),b.assignedPilotIds.map(e=>{let t=s.find(t=>t.id===e);return t?(0,a.jsxs)("div",{className:"flex items-center justify-between bg-gray-800 p-2 rounded",children:[(0,a.jsxs)("span",{className:"text-sm",children:[t.name," (Lvl ",t.level,")"]}),(0,a.jsx)(E,{variant:"ghost",size:"sm",onClick:()=>N(t.id),children:"Unassign"})]},t.id):null})]})}),(0,a.jsx)("div",{className:"mt-4",children:(0,a.jsx)(E,{onClick:()=>{h&&x&&(r(h,x),v(null))},disabled:!S,className:"w-full",children:"Assign Selected Pilot"})})]})]})]}):(0,a.jsx)("p",{className:"text-center text-muted-foreground",children:"Select a mission to view details and assign units/pilots."}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-semibold mb-2",children:"Available Ships"}),(0,a.jsx)("div",{className:"space-y-2 max-h-[200px] overflow-y-auto pr-2",children:0===i.filter(e=>!M(e.id)).length?(0,a.jsx)("p",{className:"text-muted-foreground text-sm",children:"No ships available."}):i.filter(e=>!M(e.id)).map(e=>(0,a.jsx)("div",{className:T("flex items-center justify-between bg-gray-800 p-2 rounded cursor-pointer transition-colors",f===e.id?"border-blue-500 ring-2 ring-blue-500":"hover:bg-gray-700"),onClick:()=>y(e.id),children:(0,a.jsxs)("span",{className:"text-sm text-primary-foreground",children:[e.id," (",P(e.unitType),")"]})},e.id))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-semibold mb-2",children:"Available Pilots"}),(0,a.jsx)("div",{className:"space-y-2 max-h-[200px] overflow-y-auto pr-2",children:0===s.filter(e=>!k(e.id)).length?(0,a.jsx)("p",{className:"text-muted-foreground text-sm",children:"No pilots available."}):s.filter(e=>!k(e.id)).map(e=>(0,a.jsx)("div",{className:T("flex items-center justify-between bg-gray-800 p-2 rounded cursor-pointer transition-colors",x===e.id?"border-blue-500 ring-2 ring-blue-500":"hover:bg-gray-700"),onClick:()=>v(e.id),children:(0,a.jsxs)("span",{className:"text-sm text-primary-foreground",children:[e.name," (Lvl ",e.level,")"]})},e.id))})]})]})]})]}),(0,a.jsx)(E,{onClick:m,variant:"outline",className:"w-full bg-transparent mt-4",children:"Back to Campaign Menu"})]})]})}function _(){let e=(0,n.useCallback)((e,t,i,a)=>{var n,s,l,r,o,c,d,m;let p=[...i],u=a.campaignState?{...a.campaignState}:void 0,h="mission-planning";if(!u||!t)return console.error("processMissionEnd called without valid campaignState or missionId"),a;let g=u.roundMissions.find(e=>e.id===t);if(!g)return console.error("Mission ".concat(t," not found in roundMissions for processing end.")),a;let f=null;if("escort"===g.type&&g.victoryPointsAward){let e=g.objectives.find(e=>"reach-zone-and-return"===e.type);e&&g.escortTargetUnitIds&&g.escortTargetUnitIds.forEach(t=>{let i=p.find(e=>e.id===t);if(i){var a,n,s,l;i.isEscaped&&e.hasReachedZone[t]?(u.victoryPoints.player+=(null===(a=g.victoryPointsAward)||void 0===a?void 0:a.perEscapedBomber)||0,console.log("Player gained ".concat((null===(n=g.victoryPointsAward)||void 0===n?void 0:n.perEscapedBomber)||0," VP for ").concat(i.id," escaping. Total: ").concat(u.victoryPoints.player))):i.isDestroyed&&(u.victoryPoints.enemy+=(null===(s=g.victoryPointsAward)||void 0===s?void 0:s.perDestroyedBomber)||0,console.log("Enemy gained ".concat((null===(l=g.victoryPointsAward)||void 0===l?void 0:l.perDestroyedBomber)||0," VP for ").concat(i.id," destroyed. Total: ").concat(u.victoryPoints.enemy)))}}),g.status=(null==e?void 0:e.isCompleted)?"completed":"failed"}else if("recon"===g.type&&g.victoryPointsAward){let e=g.objectives.find(e=>"visit-multiple-zones-and-return"===e.type);if(e&&e.targetUnitIds.length>0){let t=p.find(t=>t.id===e.targetUnitIds[0]);t&&(t.isEscaped&&e.isCompleted?(u.victoryPoints.player+=(null===(n=g.victoryPointsAward)||void 0===n?void 0:n.player)||0,console.log("Player gained ".concat((null===(s=g.victoryPointsAward)||void 0===s?void 0:s.player)||0," VP for Scout mission success. Total: ").concat(u.victoryPoints.player)),g.status="completed"):(t.isDestroyed?(u.victoryPoints.enemy+=(null===(l=g.victoryPointsAward)||void 0===l?void 0:l.enemy)||0,console.log("Enemy gained ".concat((null===(r=g.victoryPointsAward)||void 0===r?void 0:r.enemy)||0," VP for Scout mission failure. Total: ").concat(u.victoryPoints.enemy))):(u.victoryPoints.enemy+=(null===(o=g.victoryPointsAward)||void 0===o?void 0:o.enemy)||0,console.log("Enemy gained ".concat((null===(c=g.victoryPointsAward)||void 0===c?void 0:c.enemy)||0," VP for Scout mission failure (objectives not met). Total: ").concat(u.victoryPoints.enemy))),g.status="failed"))}}else"player-victory"===e?(g.status="completed",u.victoryPoints.player+=(null===(d=g.victoryPointsAward)||void 0===d?void 0:d.player)||1,console.log("Player gained 1 Victory Point. Total: ".concat(u.victoryPoints.player))):(g.status="failed",u.victoryPoints.enemy+=(null===(m=g.victoryPointsAward)||void 0===m?void 0:m.enemy)||1,console.log("Enemy gained 1 Victory Point. Total: ".concat(u.victoryPoints.enemy)));g.isPlayed=!0;let y="player-victory"===e?20:5;if(u.playerPilotsInBarracks=u.playerPilotsInBarracks.map(e=>{let t=p.find(t=>t.pilot.id===e.id);return t?b(t.pilot,y):e}),u.playerUnitsInBarracks=u.playerUnitsInBarracks.map(e=>{let t=p.find(t=>t.id===e.id);return t?{...t,x:0,y:0,angle:0,isDestroyed:t.isDestroyed,isEscaped:t.isEscaped,pilot:void 0}:e}).filter(e=>!e.isDestroyed),u.currentMissionId=null,u.roundMissions.every(e=>e.isPlayed)){console.log("Round complete! Generating new missions.");let e=x(800,600);u.availableMissions=e,u.roundMissions=e}return u.victoryPoints.player>=10?(h="game-over",f="player",console.log("Player reached ".concat(10," Victory Points! Campaign Victory!"))):u.victoryPoints.enemy>=10&&(h="game-over",f="enemy",console.log("Enemy reached ".concat(10," Victory Points! Campaign Defeat!"))),{...a,phase:h,currentTurn:a.currentTurn+1,selectedUnit:null,winner:f,units:[],asteroids:[],campaignState:u}},[b,P,x]),t=y(),i=x(800,600),[o,u]=(0,n.useState)(()=>({phase:"main-menu",currentTurn:1,units:[],asteroids:[],selectedUnit:null,resolutionTick:0,maxResolutionTicks:30,winner:null,campaignState:{playerUnitsInBarracks:t.units,playerPilotsInBarracks:t.pilots,availableMissions:i,roundMissions:i,currentMissionId:null,victoryPoints:{player:0,enemy:0}}})),S=o.units.find(e=>e.id===o.selectedUnit),I=(0,n.useCallback)(e=>{"planning"===o.phase&&u(t=>({...t,selectedUnit:e}))},[o.phase]),N=(0,n.useCallback)((e,t)=>{u(i=>({...i,units:i.units.map(i=>i.id===e?{...i,...t}:i)}))},[]),w=(0,n.useCallback)(e=>{"skirmish"===e?u(e=>({...e,phase:"skirmish-setup"})):"campaign"===e&&u(e=>({...e,phase:"campaign-menu"}))},[]),T=(0,n.useCallback)(e=>{let t=function e(t){switch(t){case"dogfight":return[r("Player-Fighter-1",100,250,0,"player","fighter"),r("Player-Fighter-2",100,350,0,"player","fighter"),r("Enemy-Fighter-1",700,250,Math.PI,"enemy","fighter"),r("Enemy-Fighter-2",700,350,Math.PI,"enemy","fighter")];case"escort":return[r("Player-Bomber-1",100,200,0,"player","bomber"),r("Player-Bomber-2",100,400,0,"player","bomber"),r("Player-Fighter-1",150,250,0,"player","fighter"),r("Player-Fighter-2",150,350,0,"player","fighter"),r("Enemy-Interceptor-1",700,150,Math.PI,"enemy","interceptor"),r("Enemy-Interceptor-2",700,300,Math.PI,"enemy","interceptor"),r("Enemy-Interceptor-3",700,450,Math.PI,"enemy","interceptor")];case"intercept":return[r("Player-Interceptor-1",100,150,0,"player","interceptor"),r("Player-Interceptor-2",100,300,0,"player","interceptor"),r("Player-Interceptor-3",100,450,0,"player","interceptor"),r("Enemy-Fighter-1",700,250,Math.PI,"enemy","fighter"),r("Enemy-Fighter-2",700,350,Math.PI,"enemy","fighter"),r("Enemy-Bomber-Target",650,300,Math.PI,"enemy","bomber"),r("Enemy-Bomber-2",650,400,Math.PI,"enemy","bomber")];case"lone-wolf":return[r("Player-Fighter-1",100,300,0,"player","fighter",{composure:10,control:10,gunnery:10,guts:10}),r("Enemy-Bomber-1",700,100,Math.PI,"enemy","bomber"),r("Enemy-Bomber-2",700,250,Math.PI,"enemy","bomber"),r("Enemy-Bomber-3",700,400,Math.PI,"enemy","bomber"),r("Enemy-Bomber-4",700,550,Math.PI,"enemy","bomber")];case"test-flight":return[r("Player-Bomber-1",100,200,0,"player","bomber"),r("Enemy-Bomber-1",700,400,Math.PI,"enemy","bomber"),r("Player-Fighter-1",100,250,0,"player","fighter"),r("Enemy-Fighter-1",700,350,Math.PI,"enemy","fighter"),r("Enemy-Interceptor-1",700,150,Math.PI,"enemy","interceptor"),r("Player-Interceptor-1",100,150,0,"player","interceptor"),r("Enemy-Scout-1",700,450,Math.PI,"enemy","scout"),r("Player-Scout-1",100,450,0,"player","scout"),r("Enemy-Heavy-Fighter-1",700,550,Math.PI,"enemy","heavy_fighter"),r("Player-Heavy-Fighter-1",100,550,0,"player","heavy_fighter")];default:return console.warn("Unknown setup type: ".concat(t,". Defaulting to Dogfight.")),e("dogfight")}}(e),i=k(Math.floor(4*Math.random())+3,800,600,t);u(e=>({...e,phase:"planning",currentTurn:1,units:t,asteroids:i,selectedUnit:null,resolutionTick:0,winner:null}))},[]),C=(0,n.useCallback)(()=>{u(e=>({...e,phase:"main-menu",currentTurn:1,units:[],asteroids:[],selectedUnit:null,resolutionTick:0,winner:null,campaignState:e.campaignState?{...e.campaignState,currentMissionId:null}:void 0}))},[]),B=(0,n.useCallback)(()=>{u(e=>({...e,phase:"barracks"}))},[]),Z=(0,n.useCallback)(()=>{u(e=>({...e,phase:"campaign-menu"}))},[]),_=(0,n.useCallback)(()=>{u(e=>({...e,phase:"mission-planning"}))},[]),q=(0,n.useCallback)((e,t)=>{u(i=>{if(!i.campaignState)return i;let a=i.campaignState.playerPilotsInBarracks.map(i=>i.id===e?P(i,t):i);return{...i,campaignState:{...i.campaignState,playerPilotsInBarracks:a}}})},[]),Y=(0,n.useCallback)((e,t)=>{u(i=>{if(!i.campaignState)return i;let a=i.campaignState.availableMissions.map(i=>i.id===e&&i.assignedUnitIds.length<i.playerUnitLimit&&!i.assignedUnitIds.includes(t)?{...i,assignedUnitIds:[...i.assignedUnitIds,t]}:i),n=i.campaignState.roundMissions.map(i=>i.id===e&&i.assignedUnitIds.length<i.playerUnitLimit&&!i.assignedUnitIds.includes(t)?{...i,assignedUnitIds:[...i.assignedUnitIds,t]}:i);return{...i,campaignState:{...i.campaignState,availableMissions:a,roundMissions:n}}})},[]),X=(0,n.useCallback)((e,t)=>{u(i=>{if(!i.campaignState)return i;let a=i.campaignState.availableMissions.map(i=>i.id===e&&i.assignedPilotIds.length<i.playerPilotLimit&&!i.assignedPilotIds.includes(t)?{...i,assignedPilotIds:[...i.assignedPilotIds,t]}:i),n=i.campaignState.roundMissions.map(i=>i.id===e&&i.assignedPilotIds.length<i.playerPilotLimit&&!i.assignedPilotIds.includes(t)?{...i,assignedPilotIds:[...i.assignedPilotIds,t]}:i);return{...i,campaignState:{...i.campaignState,availableMissions:a,roundMissions:n}}})},[]),G=(0,n.useCallback)((e,t)=>{u(i=>{if(!i.campaignState)return i;let a=i.campaignState.availableMissions.map(i=>{if(i.id===e){let e=i.assignedUnitIds.filter(e=>e!==t),a=i.assignedPilotIds.slice(0,e.length);return{...i,assignedUnitIds:e,assignedPilotIds:a}}return i}),n=i.campaignState.roundMissions.map(i=>{if(i.id===e){let e=i.assignedUnitIds.filter(e=>e!==t),a=i.assignedPilotIds.slice(0,e.length);return{...i,assignedUnitIds:e,assignedPilotIds:a}}return i});return{...i,campaignState:{...i.campaignState,availableMissions:a,roundMissions:n}}})},[]),Q=(0,n.useCallback)((e,t)=>{u(i=>{if(!i.campaignState)return i;let a=i.campaignState.availableMissions.map(i=>{if(i.id===e){let e=i.assignedPilotIds.filter(e=>e!==t);return{...i,assignedPilotIds:e}}return i}),n=i.campaignState.roundMissions.map(i=>{if(i.id===e){let e=i.assignedPilotIds.filter(e=>e!==t);return{...i,assignedPilotIds:e}}return i});return{...i,campaignState:{...i.campaignState,availableMissions:a,roundMissions:n}}})},[]),$=(0,n.useCallback)(function(t){let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];u(a=>{if(!a.campaignState)return a;let n=a.campaignState.availableMissions.find(e=>e.id===t);if(!n)return console.error("Mission ".concat(t," not found.")),a;if(i)return console.log("Passing mission: ".concat(n.name)),e("enemy-victory",t,[],a);if(!(n.assignedUnitIds.length>0&&n.assignedPilotIds.length>0&&n.assignedUnitIds.length===n.assignedPilotIds.length))return console.warn("Mission ".concat(t," is not ready to start. Assign ships and pilots.")),a;let s=v(n,a.campaignState.playerUnitsInBarracks,a.campaignState.playerPilotsInBarracks),l=k(Math.floor(4*Math.random())+3,800,600,s),r=a.campaignState.availableMissions.map(e=>e.id===n.id?{...e,status:"active"}:e),o=a.campaignState.roundMissions.map(e=>e.id===n.id?{...e,status:"active"}:e);return{...a,phase:"planning",currentTurn:a.currentTurn,units:s,asteroids:l,selectedUnit:null,resolutionTick:0,winner:null,campaignState:{...a.campaignState,availableMissions:r,roundMissions:o,currentMissionId:t}}})},[e,v,k]),J=(0,n.useCallback)(()=>{u(e=>{let t=[...e.units];return t=t.map(i=>{if("player"===i.team||i.isDestroyed||i.isEscaped)return i;let a=t.filter(e=>"player"===e.team&&!e.isDestroyed&&!e.isEscaped);if(0===a.length)return i;let n="straight",r="maintain",o=Number.POSITIVE_INFINITY,c=["straight","bank-left","bank-right","turn-left","turn-right","one-eight-oh","skid-left","skid-right"],d=function(e){let t=[],i=s(e.unitType);return t.push({value:"maintain",label:"Maintain Speed",disabled:!1}),t.push({value:"accelerate",label:"Accelerate (+1)",disabled:!(e.speed<e.maxSpeed)}),t.push({value:"accelerate-2",label:"Accelerate (+2)",disabled:!(i.canAccelerate2&&e.speed<i.maxSpeed-1)}),t.push({value:"decelerate",label:"Decelerate (-1)",disabled:!(e.speed>1)}),t.push({value:"decelerate-2",label:"Decelerate (-2)",disabled:!(i.canDecelerate2&&e.speed>2)}),t}(i),p=null,u=Number.POSITIVE_INFINITY;if(a.forEach(e=>{let t={...i,angle:i.angle};if(g(t,e)<=2*i.weaponRange&&m(t,e)){let t=g(i,e);t<u&&(u=t,p=e)}}),p){for(let t of(console.log("".concat(i.id," (AI): Prioritizing attack on ").concat(p.id)),c)){let a=l(t,i.speed),s=a.agility>i.agility,c=a.difficulty>i.pilot.skills.control+1,u=a.difficulty>i.pilot.skills.control,h=i.pilot.strain>=i.maxStrain&&u,y="one-eight-oh"===t&&i.speed<3;if(!s&&!c&&!h&&!y)for(let a of d){if(a.disabled)continue;let{simulatedUnit:s,collidedWithAsteroid:l}=f(i,t,a.value,30,e.asteroids);if(m(s,p)){let e=g(s,p);l&&(e+=1e4),e<o&&(o=e,n=t,r=a.value)}}}o===Number.POSITIVE_INFINITY&&(console.log("".concat(i.id," (AI): Could not maintain attack range, falling back to approach.")),p=null)}if(!p){console.log("".concat(i.id," (AI): Prioritizing approach to nearest player unit."));let t=a.reduce((e,t)=>g(i,t)<g(i,e)?t:e);for(let a of c){let s=l(a,i.speed),c=s.agility>i.agility,m=s.difficulty>i.pilot.skills.control+1,p=s.difficulty>i.pilot.skills.control,u=i.pilot.strain>=i.maxStrain&&p,h="one-eight-oh"===a&&i.speed<3;if(!c&&!m&&!u&&!h)for(let s of d){if(s.disabled)continue;let{simulatedUnit:l,collidedWithAsteroid:c}=f(i,a,s.value,30,e.asteroids),d=g(l,t);c&&(d+=1e4),d<o&&(o=d,n=a,r=s.value)}}}return{...i,plannedManeuver:n,plannedSpeedChange:r,targetMode:p?"target-specific":"fire-at-will",specificTarget:p?p.id:void 0}}),{...e,phase:"resolution",resolutionTick:0,selectedUnit:null,units:t.map(e=>c(e,30)),asteroids:e.asteroids.map(e=>({...e,collidedUnitsThisPhase:[]}))}})},[]),K=(0,n.useCallback)(()=>{u(t=>{let i=[...t.units],a=(i=i.map(e=>{if(e.isDestroyed||e.isEscaped)return e;let t=Math.min(e.pilot.morale+e.pilot.skills.composure,e.pilot.maxMorale),i={...e,pilot:{...e.pilot,morale:t},angle:e.initialAngle+e.finalOrientationChange};return"one-eight-oh"===i.plannedManeuver&&(i={...i,speed:1}),i})).filter(e=>"player"===e.team&&!e.isDestroyed&&!e.isEscaped).length,n=i.filter(e=>"enemy"===e.team&&!e.isDestroyed&&!e.isEscaped).length;if(!t.campaignState||!t.campaignState.currentMissionId){let e=null;return(0===a?e="enemy":0===n&&(e="player"),e)?(i.forEach(t=>{if("player"===t.team&&!t.isDestroyed&&!t.isEscaped){let i="player"===e?10:2;t.pilot=b(t.pilot,i)}}),{...t,phase:"game-over",currentTurn:t.currentTurn+1,selectedUnit:null,winner:e,units:i,asteroids:t.asteroids}):{...t,phase:"planning",currentTurn:t.currentTurn+1,selectedUnit:null,units:i,asteroids:t.asteroids}}let s=t.campaignState.availableMissions.find(e=>e.id===t.campaignState.currentMissionId);if(!s)return console.error("Current mission not found in handleEndResolution for campaign."),t;let{updatedMission:l,updatedUnits:r,isMissionComplete:o}=M(s,i),c=null,d=r.filter(e=>"player"===e.team&&!e.isDestroyed&&!e.isEscaped).length;if(r.filter(e=>"enemy"===e.team&&!e.isDestroyed&&!e.isEscaped).length,"escort"===l.type&&l.escortTargetUnitIds&&l.escortTargetUnitIds.every(e=>{let t=r.find(t=>t.id===e);return(null==t?void 0:t.isDestroyed)&&!(null==t?void 0:t.isEscaped)})&&(c="enemy-victory",console.log("Escort mission failed: All escort targets destroyed before escaping.")),null===c&&o&&(c="player-victory"),0===d&&(c="enemy-victory"),null!==c){let i=t.campaignState.availableMissions.map(e=>e.id===l.id?l:e),a=t.campaignState.roundMissions.map(e=>e.id===l.id?l:e);return e(c,l.id,r,{...t,campaignState:{...t.campaignState,availableMissions:i,roundMissions:a},units:r})}{console.log("Resolution ended, mission ongoing. Returning to planning phase for next turn.");let e=t.campaignState.availableMissions.map(e=>e.id===l.id?l:e),i=t.campaignState.roundMissions.map(e=>e.id===l.id?l:e),a=t.campaignState.availableMissions.findIndex(e=>e.id===t.campaignState.currentMissionId);return -1!==a&&({...t.campaignState.availableMissions[a]}).objectives.map(e=>{"visit-multiple-zones-and-return"===e.type&&console.log({...e})}),{...t,phase:"planning",currentTurn:t.currentTurn+1,selectedUnit:null,units:r,asteroids:t.asteroids,campaignState:{...t.campaignState,availableMissions:e,roundMissions:i}}}})},[e]);(0,n.useEffect)(()=>{if("resolution"!==o.phase)return;let e=setInterval(()=>{u(e=>{if(e.resolutionTick>=e.maxResolutionTicks||null!==e.winner)return e;let t=[...e.units],i=[...e.asteroids],a=new Map(e.units.map(e=>[e.id,e.isDestroyed]));e.units.map(e=>[e.id,e.isEscaped]),(t=t.map(t=>t.isDestroyed||t.isEscaped?t:d(t,.1,e.maxResolutionTicks))).forEach((e,a)=>{e.isDestroyed||e.isEscaped||i.forEach((n,s)=>{if(!n.collidedUnitsThisPhase.includes(e.id)&&g(e,n)<n.radius+20){let l=10*e.speed;console.log("".concat(e.id," collided with ").concat(n.id," at speed ").concat(e.speed,", taking ").concat(l," damage.")),t[a]=p(t[a],l),i[s]={...i[s],collidedUnitsThisPhase:[...i[s].collidedUnitsThisPhase,e.id]},t[a]={...t[a],pilot:{...t[a].pilot,morale:Math.max(t[a].pilot.morale-15,0)}},console.log("".concat(e.id," morale reduced to ").concat(t[a].pilot.morale," due to asteroid collision."))}})}),t.forEach((i,a)=>{if(i.isDestroyed||i.isEscaped||!(i.weaponCharge>=i.maxWeaponCharge))return;let n=t.filter(e=>e.team!==i.team&&!e.isDestroyed&&!e.isEscaped),l=null;if("target-specific"===i.targetMode&&i.specificTarget){let e=n.find(e=>e.id===i.specificTarget);e&&m(i,e)&&(l=e)}else"fire-at-will"===i.targetMode&&(l=function(e,t){let i=t.filter(t=>!t.isDestroyed&&m(e,t));return 0===i.length?null:i.reduce((t,i)=>Math.sqrt(Math.pow(i.x-e.x,2)+Math.pow(i.y-e.y,2))<Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))?i:t)}(i,n));if(l){let n=!1,r=0;for(let t=0;t<i.burst;t++)if(function(e,t,i,a){let n=.5+.04*e;return t>=75&&(n+=.05),t>=100&&(n+=.05),t<=25&&(n-=.05),n=Math.max(0,Math.min(1,n)),!(Math.random()<.02*i+.02*a)&&Math.random()<n}(i.pilot.skills.gunnery,i.pilot.morale,l.pilot.skills.control,l.speed)){n=!0;let a=s(i.unitType).damage;r+=a,console.log("Tick ".concat(e.resolutionTick,": ").concat(i.id," shot ").concat(t+1," HIT ").concat(l.id," for ").concat(a," damage."))}else console.log("Tick ".concat(e.resolutionTick,": ").concat(i.id," shot ").concat(t+1," MISSED ").concat(l.id));if(r>0){let n=t.findIndex(e=>e.id===l.id);-1!==n&&(t[n]=p(t[n],r),t[n]={...t[n],pilot:{...t[n].pilot,morale:Math.max(t[n].pilot.morale-5,0)}}),t[a]={...t[a],pilot:{...t[a].pilot,morale:Math.min(t[a].pilot.morale+5,t[a].pilot.maxMorale)}},console.log("Tick ".concat(e.resolutionTick,": ").concat(i.id," burst dealt total ").concat(r," damage to ").concat(l.id,". ").concat(i.id," morale +5, ").concat(l.id," morale -5."))}else console.log("Tick ".concat(e.resolutionTick,": ").concat(i.id," burst missed all shots against ").concat(l.id,"."));t[a]=function(e,t,i){let a={...e};return a.firingLine={fromX:e.x,fromY:e.y,toX:t.x,toY:t.y,ticksRemaining:3,hasTarget:i},a.weaponCharge=0,a}(t[a],l,n)}});let n=t.filter(e=>e.isDestroyed&&!a.get(e.id));n.length>0&&n.forEach(i=>{t=t.map(t=>t.isDestroyed||t.isEscaped?t:t.team===i.team?(console.log("Tick ".concat(e.resolutionTick,": Friendly ship ").concat(i.id," destroyed. ").concat(t.id," loses 10 morale.")),{...t,pilot:{...t.pilot,morale:Math.max(t.pilot.morale-10,0)}}):(console.log("Tick ".concat(e.resolutionTick,": Enemy ship ").concat(i.id," destroyed. ").concat(t.id," gains 10 morale.")),{...t,pilot:{...t.pilot,morale:Math.min(t.pilot.morale+10,t.pilot.maxMorale)}}))});let l=t.map(t=>{let i=e.units.find(e=>e.id===t.id);return i&&i.isDestroyed&&!t.isDestroyed?{...t,isDestroyed:!0}:t});if(e.campaignState&&e.campaignState.currentMissionId){let a=e.campaignState.availableMissions.findIndex(t=>t.id===e.campaignState.currentMissionId);if(-1!==a){let n={...e.campaignState.availableMissions[a]},s=n.objectives.map(i=>{if("reach-zone-and-return"!==i.type||i.isCompleted){if("visit-multiple-zones-and-return"===i.type){let e={...i},a=l.find(t=>t.id===e.targetUnitIds[0]);if(a&&!a.isDestroyed&&(e.targetZones.forEach(t=>{!e.hasVisitedZone[t.id]&&g(a,t)<t.radius+10&&(e.hasVisitedZone[t.id]=!0,console.log("".concat(a.id," entered target zone ").concat(t.id)))}),e.targetZones.every(t=>e.hasVisitedZone[t.id])&&!e.hasEscapedZone[a.id])){let i={x:e.escapeZone.x-e.escapeZone.width/2,y:e.escapeZone.y-e.escapeZone.height/2,width:e.escapeZone.width,height:e.escapeZone.height};if(a.x<i.x+i.width&&a.y>i.y&&a.y<i.y+i.height){e.hasEscapedZone={...e.hasEscapedZone,[a.id]:!0};let i=t.findIndex(e=>e.id===a.id);-1!==i&&(t[i]={...t[i],isEscaped:!0}),console.log("".concat(a.id," escaped mission."))}}return e}}else{let a={...i},n=!1;return a.targetUnitIds.forEach(i=>{let s=t.find(e=>e.id===i);if(s&&!s.isDestroyed&&!s.isEscaped){if(!a.hasReachedZone[i]){let t=h(s,e.maxResolutionTicks),l=a.targetZone;t.some(e=>g(e,l)<=l.radius+20)&&(a.hasReachedZone={...a.hasReachedZone,[i]:!0},console.log("".concat(s.id," entered target zone!")),n=!0)}if(a.hasReachedZone[i]&&!a.hasEscapedZone[i]){let e={x:a.escapeZone.x-a.escapeZone.width/2,y:a.escapeZone.y-a.escapeZone.height/2,width:a.escapeZone.width,height:a.escapeZone.height},l=s.x-20,r=s.x+20,o=s.y-20,c=s.y+20,d=e.x,m=e.x+e.width,p=e.y,u=e.y+e.height;if(r>d&&l<m&&c>p&&o<u){a.hasEscapedZone={...a.hasEscapedZone,[i]:!0};let e=t.findIndex(e=>e.id===i);-1!==e&&(t[e]={...t[e],isEscaped:!0}),console.log("".concat(s.id," escaped the mission!")),n=!0}}}}),n?a:i}return i}),r=e.campaignState.availableMissions.map((e,t)=>t===a?{...n,objectives:s}:e),o=e.campaignState.roundMissions.map((e,t)=>t===a?{...n,objectives:s}:e),c=e.resolutionTick+1;return{...e,campaignState:{...e.campaignState,availableMissions:r,roundMissions:o},units:t,asteroids:i,resolutionTick:c,winner:null}}}t=t.map(e=>({...e,x:Math.max(20,Math.min(780,e.x)),y:Math.max(20,Math.min(580,e.y))}));let r=e.resolutionTick+1,o=t.filter(e=>"player"===e.team&&!e.isDestroyed&&!e.isEscaped).length,c=t.filter(e=>"enemy"===e.team&&!e.isDestroyed&&!e.isEscaped).length,u=null;if(0===o)u="enemy";else if(e.campaignState&&e.campaignState.currentMissionId){let i=e.campaignState.availableMissions.find(t=>t.id===e.campaignState.currentMissionId);if(i){let{updatedMission:e,updatedUnits:a,isMissionComplete:n}=M(i,t);t=a,"escort"===e.type&&e.escortTargetUnitIds&&e.escortTargetUnitIds.every(e=>{let i=t.find(t=>t.id===e);return(null==i?void 0:i.isDestroyed)&&!(null==i?void 0:i.isEscaped)})&&(u="enemy"),null===u&&n&&(u="player")}}else 0===c&&(u="player");return{...e,units:t,asteroids:i,resolutionTick:r,winner:u}})},50);return()=>clearInterval(e)},[o.phase]),(0,n.useEffect)(()=>{if("resolution"===o.phase&&(o.resolutionTick>=o.maxResolutionTicks||null!==o.winner)){let e=setTimeout(()=>{K()},1e3);return()=>clearTimeout(e)}},[o.phase,o.resolutionTick,o.winner,K]);let ee=()=>{let e=y(),t=x(800,600);u({phase:"main-menu",currentTurn:1,units:[],asteroids:[],selectedUnit:null,resolutionTick:0,maxResolutionTicks:30,winner:null,campaignState:{playerUnitsInBarracks:e.units,playerPilotsInBarracks:e.pilots,availableMissions:t,roundMissions:t,currentMissionId:null,victoryPoints:{player:0,enemy:0}}})};return(0,a.jsxs)("div",{className:"min-h-screen bg-gray-900 p-4 flex flex-col items-center justify-center",children:["main-menu"!==o.phase&&"skirmish-setup"!==o.phase&&"campaign-menu"!==o.phase&&"barracks"!==o.phase&&"mission-planning"!==o.phase&&"game-over"!==o.phase&&(0,a.jsxs)("div",{className:"mb-4 text-center",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-white mb-2",children:"Space Dogfight"}),(0,a.jsxs)("p",{className:"text-gray-300",children:["Turn ",o.currentTurn," - ","planning"===o.phase?"Planning Phase":"Resolution Phase"]})]}),"mission-planning"===o.phase&&o.campaignState&&(0,a.jsxs)("div",{className:"mb-4 text-center text-white",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold mb-2",children:"Campaign"}),(0,a.jsxs)("p",{className:"text-lg",children:["Victory Points: Player ",o.campaignState.victoryPoints.player," - Enemy"," ",o.campaignState.victoryPoints.enemy]}),(0,a.jsxs)("p",{className:"text-gray-300",children:["Turn ",o.currentTurn," - Mission Planning"]})]}),(()=>{var e;let t=(null===(e=o.campaignState)||void 0===e?void 0:e.currentMissionId)?o.campaignState.availableMissions.find(e=>{var t;return e.id===(null===(t=o.campaignState)||void 0===t?void 0:t.currentMissionId)}):void 0;return(0,a.jsx)(a.Fragment,{children:(()=>{var e,i,n,s,l,r,c,d;switch(o.phase){case"main-menu":return(0,a.jsx)(V,{onSelectOption:w});case"skirmish-setup":return(0,a.jsx)(z,{onStartSkirmish:T,onBackToMenu:C});case"campaign-menu":return(0,a.jsx)(W,{onOpenMissionPlanning:_,onOpenBarracks:B,onBackToMainMenu:C});case"barracks":return(0,a.jsx)(H,{playerPilotsInBarracks:(null===(e=o.campaignState)||void 0===e?void 0:e.playerPilotsInBarracks)||[],onLevelUpPilotSkill:q,onBackToCampaignMenu:Z});case"mission-planning":return(0,a.jsx)(O,{availableMissions:(null===(i=o.campaignState)||void 0===i?void 0:i.roundMissions)||[],playerUnitsInBarracks:(null===(n=o.campaignState)||void 0===n?void 0:n.playerUnitsInBarracks)||[],playerPilotsInBarracks:(null===(s=o.campaignState)||void 0===s?void 0:s.playerPilotsInBarracks)||[],onAssignUnitToMission:Y,onAssignPilotToMission:X,onUnassignUnitFromMission:G,onUnassignPilotFromMission:Q,onStartSelectedMission:$,onBackToCampaignMenu:Z,playerVictoryPoints:(null===(l=o.campaignState)||void 0===l?void 0:l.victoryPoints.player)||0,enemyVictoryPoints:(null===(r=o.campaignState)||void 0===r?void 0:r.victoryPoints.enemy)||0});case"planning":case"resolution":return(0,a.jsxs)("div",{className:"flex gap-4 justify-center",children:[(0,a.jsx)(j,{units:o.units,selectedUnit:o.selectedUnit,onUnitSelect:I,width:800,height:600,maxResolutionTicks:30,isPlanningPhase:"planning"===o.phase,asteroids:o.asteroids,currentMission:t}),"planning"===o.phase?(0,a.jsx)(L,{selectedUnit:S||null,units:o.units,onUpdateUnit:N,onStartResolution:J}):(0,a.jsx)(F,{currentTick:o.resolutionTick,maxTicks:o.maxResolutionTicks,onEndResolution:K})]});case"game-over":return(0,a.jsxs)(U,{className:"w-96",children:[(0,a.jsx)(D,{children:(0,a.jsx)(R,{className:"text-center",children:"Game Over"})}),(0,a.jsxs)(A,{className:"text-center space-y-4",children:[(0,a.jsx)("p",{className:"text-2xl font-bold",children:"player"===o.winner?"\uD83C\uDF89 Campaign Victory!":"\uD83D\uDCA5 Campaign Defeat!"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"player"===o.winner?"You reached ".concat(null===(c=o.campaignState)||void 0===c?void 0:c.victoryPoints.player," Victory Points!"):"The Enemy reached ".concat(null===(d=o.campaignState)||void 0===d?void 0:d.victoryPoints.enemy," Victory Points!")}),(0,a.jsx)(E,{onClick:ee,className:"w-full",children:"New Game"})]})]});default:return null}})()})})(),"main-menu"!==o.phase&&"skirmish-setup"!==o.phase&&"campaign-menu"!==o.phase&&"barracks"!==o.phase&&"mission-planning"!==o.phase&&"game-over"!==o.phase&&(0,a.jsx)("div",{className:"mt-4 text-center",children:(0,a.jsx)(E,{onClick:ee,variant:"outline",children:"New Game"})})]})}Z.displayName=B.bL.displayName},4438:(e,t,i)=>{Promise.resolve().then(i.bind(i,3878))}},e=>{var t=t=>e(e.s=t);e.O(0,[446,441,684,358],()=>t(4438)),_N_E=e.O()}]);